<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pago pendiente</title>
    <link rel="stylesheet" href="style.css?v=mobfix-1" />
    <link rel="stylesheet" href="css/success.css" />
  </head>
  <body>
    <header>
      <div class="header-inner">
        <div class="logo"><a href="/index.html" class="brand"><img src="../assets/IMG_3086.png" alt="NERIN" class="site-logo" /></a></div>
        <button class="menu-toggle" id="navToggle">☰</button>
        <nav id="mainNav">
          <ul>
            <li><a href="/index.html">Inicio</a></li>
            <li><a href="/shop.html">Productos</a></li>
            <li><a href="/contact.html">Contacto</a></li>
            <li><a href="/seguimiento.html">Seguir mi pedido</a></li>
            <li><a href="/cart.html">Carrito</a></li>
            <li><a href="/login.html">Acceder</a></li>
          </ul>
        </nav>
      </div>
    </header>
    <noscript>
      <style>
        .noscript-msg {
          max-width: 600px;
          margin: 2rem auto;
          padding: 1rem;
          text-align: center;
        }
      </style>
      <div class="noscript-msg">
        Por favor habilitá JavaScript para ver el estado de tu pago.
      </div>
    </noscript>
    <main class="container">
      <div class="status-icon pending" aria-hidden="true">
        <svg viewBox="0 0 24 24" class="icon">
          <circle class="draw" cx="12" cy="12" r="9" />
          <path class="draw" d="M12 8v4l2 2" />
        </svg>
      </div>
      <article class="receipt" id="statusContainer">
        <h1>Pago pendiente</h1>
        <p class="date" id="fecha"></p>
        <div id="statusMessage">
          <div class="spinner"></div>
          <p>Estamos confirmando tu pago...</p>
        </div>
      </article>
    </main>
    <script type="module" src="/js/config.js"></script>
    <script src="/js/order-status.js"></script>
    <script>
      document.getElementById('fecha').textContent = new Date().toLocaleString('es-AR', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
      document.addEventListener('DOMContentLoaded', async () => {
        try {
          const id = getIdentifier();
          showProcessing();
          if (!id) return;
          const { status, id: resolvedId, numeroOrden } = await pollOrderStatus(id);
          if (status === 'approved') {
            showApproved(numeroOrden || resolvedId);
            localStorage.removeItem('mp_last_pref');
            localStorage.removeItem('mp_last_nrn');
          } else if (status === 'rejected') {
            showRejected();
          } else {
            showProcessing('Estamos acreditando tu pago...');
          }
        } catch (e) {
          const el = document.getElementById('statusMessage');
          if (el) {
            el.innerHTML = '<p>Ocurrió un problema al verificar tu pago. Intentá nuevamente más tarde.</p>';
          }
        }
      });
    </script>
  </body>
</html>
